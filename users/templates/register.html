{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="{% static 'users/css/style.css' %}">
    <title>Registration | AsmrProg</title>
</head>

<body>

    <div class="logo">
        <img src="logo.png">
        <a href="#">AsmrProg</a>
    </div>

    <div class="container">
        <h1>Create an account ðŸš€</h1>
        <div class="social-login">
            <button class="google">
                <i class='bx bxl-google'></i>
                Sign up with Google
            </button>
            <button class="apple">
                <i class='bx bxl-apple'></i>
                Sign up with Apple
            </button>
        </div>
        <div class="divider">
            <div class="line"></div>
            <p>Or</p>
            <div class="line"></div>
        </div>

        <form method='post' id='registrationForm'>
            {% csrf_token %}
            <label for="{{ form.username.id_for_label }}">Username:</label>
            <div class='custome-input'>
            {{ form.username }}
            </div>

            <label for="{{ form.password.id_for_label }}">Password:</label>
            <div class='custome-input'>
            {{ form.password }}
            </div>
            
            <label for="{{ form.email.id_for_label }}">Email:</label>
            <div class='custome-input'>
            {{ form.email }}
            </div>
            <button type="submit" class="login">Register</button>
            <div class="links">
                <a href="">Forgot Password?</a>
                <a href="">Already have an account?</a>
            </div>
        </form>
        <script>
            document.getElementById('registrationForm').addEventListener('submit', function (event) {
                event.preventDefault();  // ÐžÑ‚Ð¼ÐµÐ½ÑÐµÐ¼ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ñ„Ð¾Ñ€Ð¼Ñ‹
                var formData = new FormData(this);
        
                // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
                fetch('http://localhost:8000/api/auth/users/', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    console.log('ÐžÑ‚Ð²ÐµÑ‚ ÑÐµÑ€Ð²ÐµÑ€Ð°:', response);
                    return response.json();
                })
                .then(data => {
                    console.log('Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ñ‚ ÑÐµÑ€Ð²ÐµÑ€Ð°:', data);
                    if (data.id) {
                        // ÐŸÐµÑ€ÐµÐ½Ð°Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ÑÐ»Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð¹ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸
                        window.location.href = 'http://localhost:8000/api/login/';
                    } else {
                        console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ñ„Ð¾Ñ€Ð¼Ñ‹:', data.message || 'ÐÐµÐ¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°');
                    }
                })
                .catch(error => console.error('ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ°:', error));
            });
        </script>
    </div>

</body>

</html>